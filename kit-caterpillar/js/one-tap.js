function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,r)}return o}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(o),!0).forEach(function(t){_defineProperty(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:t+""}function _toPrimitive(e,t){if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var OneTapWidget=function(){"use strict";var e={HEADERS:{CONTENT_TYPE:"Content-Type",X_CLIENT_TYPE:"X-Client-Type",X_CONTEXTUAL:"X-Contextual",X_PLATFORM_ID:"X-Platform-Id",X_SITE_ID:"X-Site-Id",X_SOURCE:"X-Source",X_USER_AGENT:"X-User-Agent"},MELIDATA_ACTION:{CLEAN_AND_SEND:"cleanAndSend"},MELIDATA_TYPE:{EVENT:"event",SHOW:"show"},NOT_APPLY:"not_apply",TRACK_KEY:{ONE_TAP_SHOW:"oneTapShow",ONE_TAP_COMPLETE:"oneTapComplete",ONE_TAP_SKIPPED:"oneTapSkipped"}};const{MELIDATA_ACTION:t,MELIDATA_TYPE:o,NOT_APPLY:r,TRACK_KEY:n}=e,a=(e,t)=>{const{contextual:o,showOneTap:a,selectBy:i,errorReason:c}=t,s={contextual:o||r,social_app:"google",source:"external",tracking_id:r};return{[n.ONE_TAP_SHOW]:_objectSpread(_objectSpread({},s),{},{widget_type:"google_one_tap",shown:a}),[n.ONE_TAP_COMPLETE]:_objectSpread(_objectSpread({},s),{},{selected_method:"google_one_tap",select_by:i||r}),[n.ONE_TAP_SKIPPED]:_objectSpread({},s),[n.ONE_TAP_ERROR]:_objectSpread(_objectSpread({},s),{},{reason:c||r})}[e]},i={[n.ONE_TAP_SHOW]:{path:"/auth/social_account/google/widget",type:o.SHOW},[n.ONE_TAP_COMPLETE]:{path:"/auth/social_account/google/complete",type:o.EVENT},[n.ONE_TAP_SKIPPED]:{path:"/auth/social_account/google/skipped",type:o.EVENT},[n.ONE_TAP_ERROR]:{path:"/auth/social_account/google/error",type:o.SHOW}};const c=(e,o)=>{var r;const n=((e,t)=>{const{experimentData:o}=t;return _objectSpread({path:i[e].path,eventData:a(e,t)},o&&{experiments:{[o.name]:o.variant}})})(e,o);null!==(r=window)&&void 0!==r&&r.melidata&&window.melidata(t.CLEAN_AND_SEND,i[e].type,_objectSpread({path:n.path,event_data:n.eventData},n.experiments&&{experiments:n.experiments}))},{HEADERS:s,TRACK_KEY:l}=e,_={common:{snackbarError:"Ocurrió un error, vuelve a intentarlo más tarde."},es_AR:{snackbarError:"Ocurrió un error, volvé a intentarlo más tarde."},pt_BR:{snackbarError:"Ocorreu um erro, tente novamente mais tarde."},en_US:{snackbarError:"Something went wrong, please try again later."}},p=window.trustedTypes&&window.trustedTypes.createPolicy?window.trustedTypes.createPolicy("ml-web-navigation",{createScriptURL(e){if("https://accounts.google.com/gsi/client"===e)return e;throw new Error("URL no permitida por la política de Trusted Types")}}):void 0;var g=class{constructor(e){let{bus:t,experimentData:o,showOneTap:r,go:n,googleClientId:a,navigation:i}=e;this._bus=t,this._go=n,this._googleClientId=a,this._navigation=i,this.track(l.ONE_TAP_SHOW,{showOneTap:r,experimentData:o}),r&&this.initGoogleOneTap()}get bus(){return this._bus}get go(){return this._go}get googleClientId(){return this._googleClientId}get navigation(){return this._navigation}getTranslations(){switch(this.navigation.siteId){case"MLB":return _.pt_BR;case"MLA":return _.es_AR;case"CBT":return _.en_US;default:return _.common}}track(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=_objectSpread({contextual:this.navigation.contextual},t);c(e,o)}initGoogleOneTap(){const e=document.createElement("script");var t;e.src=(t="https://accounts.google.com/gsi/client",p?p.createScriptURL(t):t),e.async=!0,e.defer=!0,e.onload=()=>{var e,t;null===(e=window.google)||void 0===e||e.accounts.id.initialize({client_id:this.googleClientId,callback:e=>this.handleGoogleCallback(e),cancel_on_tap_outside:!1,itp_support:!0,use_fedcm_for_prompt:!0}),null===(t=window.google)||void 0===t||t.accounts.id.prompt(e=>{e.isSkippedMoment()&&this.track(l.ONE_TAP_SKIPPED)})},document.head.appendChild(e)}async handleGoogleCallback(e){const t=await this.googleCredentialValidation(e);null!=t&&t.link&&(this.track(l.ONE_TAP_COMPLETE,{selectBy:e.select_by}),window.location.assign(t.link))}async googleCredentialValidation(e){try{const t=this.getSocialApiURL(),o={[s.CONTENT_TYPE]:"application/json",[s.X_CLIENT_TYPE]:"web",[s.X_CONTEXTUAL]:this.navigation.contextual,[s.X_PLATFORM_ID]:this.navigation.platformId,[s.X_SITE_ID]:this.navigation.siteId,[s.X_SOURCE]:"login",[s.X_USER_AGENT]:window.navigator.userAgent},r=await fetch(t,{method:"POST",headers:o,body:JSON.stringify({google_jwt:e.credential,data:{query_params:{contextual:this.navigation.contextual,loginType:"social_google_external",redirect_url:this.go,selected_method:"google_one_tap"}}})});return await r.json()}catch(e){return this.track(l.ONE_TAP_ERROR,{errorReason:e.message}),this.bus.emit("snackbar:show",{message:this.getTranslations().snackbarError})}}getSocialApiURL(e){const t=new URL("social-account-api/public/social/google/account","https://api.mercadolibre.com");return e&&t.searchParams.set("scope",e),t.href}};return g}();
